<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="assets/style.css" />
  <title>Verify OTP</title>
</head>
<body>
  <div class="scene">
    <div class="card">
      <div class="inner">
        <h1>OTP Verify</h1>
        <p>Enter 6-digit OTP (expires quickly).</p>

        <div class="field">
          <label>OTP</label>
          <input id="otp" inputmode="numeric" maxlength="6" placeholder="123456" />
        </div>

        <button class="btn" id="btn">Verify</button>
        <div class="toast" id="toast"></div>

        <p class="small" style="margin-top:12px;">
          Back to <a class="link" href="login.html">Login</a>
        </p>
      </div>
    </div>
  </div>

<script>
const toast = (m)=>{ const t=document.getElementById('toast'); t.textContent=m; t.className="toast show"; };
document.getElementById('btn').onclick = async () => {
  const otp = document.getElementById('otp').value.trim();
  const tempToken = localStorage.getItem("tempToken");
  if(!otp || otp.length!==6) return toast("Enter valid 6-digit OTP.");
  if(!tempToken) return toast("Temp session missing. Login again.");

  const r = await fetch("/.netlify/functions/verifyOtp", {
    method:"POST",
    body: JSON.stringify({ otp, tempToken })
  });
  const data = await r.json().catch(()=>null);

  if(!r.ok) return toast((data && data.error) ? data.error : "Verify failed");
  localStorage.setItem("authToken", data.authToken);
  localStorage.removeItem("tempToken");
  toast("Verified âœ…");
  setTimeout(()=>location.href="dashboard.html", 700);
};
</script>
</body>
</html>
